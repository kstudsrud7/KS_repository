


Steps to Configure the Power Automate Scheduled Flow:
- Create a Scheduled Flow:
    - Log in to Power Automate: Go to Power Automate.
    - Create a new flow: Select "Create" from the left-hand side menu and then choose "Scheduled cloud flow".
    - Set schedule details: Name your flow (e.g., "Reverification Reminder Flow") and set the recurrence to "Every day" to run the flow nightly.
- Initialize Variables:
    - Add a new step: Click on "New step" and select "Initialize variable".
    - Name: sendReverificationReminders
        - Type: Boolean
        - Value: false
    - Add another variable: Initialize another variable for the number of days in advance.
        - Name: sendDaysInAdvance
        - Type: Integer
        - Value: 60 (default)
- Get Configuration Settings:
    - Add a new step: Select "New step" and choose "Get record" from the Dataverse connector (assuming Dataverse is used).
    - Table name: Configuration Entity
    - Row ID: Enter the ID of the configuration record.
    - Update Variables: Use "Set variable" actions to update the sendReverificationReminders and sendDaysInAdvance variables based on the retrieved configuration record.
- Query Service Requests:
    - Add a new step: Select "List rows" from the Dataverse connector to retrieve service requests where the reverification due date is within the next 60 days.
    - Table name: Service Request
    - Filter Query: reverification_due_date eq '@{formatDateTime(addDays(utcNow(), variables('sendDaysInAdvance')), 'yyyy-MM-dd')}'
- Loop Through Service Requests:
    - Add a new step: Select "Apply to each" to loop through the retrieved service requests.
    - Select an output from previous steps: Choose the value from the "List rows" step.
    - Inside the loop, add the following actions:
        - Condition: Check if sendReverificationReminders is true.
            - If Yes:
                - Create a reverification record:
                    - Add a new step: Select "Add a new row" from the Dataverse connector.
                    - Table name: Reverification
                    - Columns: Set the columns as per the requirements (e.g., Type, Status, etc.).
                - Send an email reminder:
                    - Add a new step: Select "Send an email (V2)" from the Office 365 Outlook connector.
                    - To: Student's email address (retrieve from the service request or student profile).
                    - Subject: "Reverification Reminder"
                    - Body: Use the provided email template, populating necessary dynamic content from the service request.
                - Update service request:
                    - Add a new step: Select "Update a row" from the Dataverse connector.
                    - Table name: Service Request
                    - Row ID: ID of the current service request.
                    - Columns: Set the reverification status to "Student Notified".
- Test and Enable the Flow:
    - Test the Flow: Manually test the flow using sample data to ensure it works as expected.
    - Enable the Flow: Once tested, enable the flow to run as scheduled.
- Areas to Consider:
    - Configuration Entity: Ensure that the configuration entity exists and has the necessary fields (sendReverificationReminders and sendDaysInAdvance).
    - Email Template: Verify that the email template (v2) is correctly formatted and contains all required placeholders.
    - Permissions: Ensure the flow has the necessary permissions to access Dataverse entities and send emails.
    - Error Handling: Implement error handling to manage cases where records cannot be created or emails fail to send.
